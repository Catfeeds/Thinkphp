<extend name="Public:base"/>
<block name='resmenu'>active open</block>
<block name='ressubmenuvideomgrtv'>active</block>
<block name="pagecont">
	<div id="main-container">
		<div class="padding-md">
			<div class="panel panel-default">
				<div class="panel-heading">
					<h3>{$title}</h3>
				</div>
				<div class="panel-body">
					<form id="formToggleLine" action="__ACTION__" class="form-horizontal no-margin form-border"  method="post" enctype="multipart/form-data">
						<div class="form-group">
							<label class="col-lg-2 control-label"><em class="text-danger">*&nbsp;</em>视频名称</label>
							<div class="col-lg-10">
								<input class="form-control" type="text" placeholder="请输入视频名称" name="name" value="{$data.name}">
							</div>
						</div>
						<div class="form-group">
							<label class="col-lg-2 control-label"><em class="text-danger">*&nbsp;</em>视频封面图</label>
							<div class="col-lg-10">
								<input class="form-control" type="file" name="coverimg">
							</div>
						</div>

						<notempty name="data.cover">
							<div class="form-group">
								<label class="col-lg-2 control-label">当前封面</label>
								<div class="col-lg-10">
									<img src="{$Think.WEB_ROOT}{$data.cover}" height="120px"/>
								</div>
							</div>
						</notempty>

						<div class="form-group">
							<label class="col-lg-2 control-label"><em class="text-danger">*&nbsp;</em>视频</label>
							<div class="col-lg-10">
								<input class="form-control" type="text" placeholder="请输入视频路径" name="filepath" value="{$data.filepath}">
							</div>
							<!--
							<div class="col-lg-10">
								<input class="form-control" type="file" name="filepath">
							</div>
							-->
						</div>

						<div class="form-group">
							<label class="col-lg-2 control-label"><em class="text-danger">*&nbsp;</em>标签</label>
							<div class="col-lg-10" style="width: 180px">
								<select name="category_two" id="label_cate"  class="form-control">
									<foreach name="types2" item="v">
										<option value="{$v.id},{$v.keywords}">
											{$v.name}
										</option>
									</foreach>
								</select>
							</div>

							<!--
							<div class="col-lg-10">
								<input class="form-control" type="text" placeholder="请输入游戏标签，之间以逗号分割" name="tags" value="{$data.tags}">
							</div>
							-->
						</div>

						<!--<div class="form-group">-->
						<!--<label class="col-lg-2 control-label">类型</label>-->
						<!--<div class="col-lg-10">-->
						<!--<label class="label-radio inline">-->
						<!--<input type="radio" name="type" value="1"  <if condition="($data.type eq '1')">checked='checked' </if> >-->
						<!--<span class="custom-radio"></span>-->
						<!--电影-->
						<!--</label>-->
						<!--<label class="label-radio inline">-->
						<!--<input type="radio" name="type" value="2"  <if condition="($data.type eq '2')">checked='checked' </if> >-->
						<!--<span class="custom-radio"></span>-->
						<!--剧集-->
						<!--</label>-->
						<!--</div>-->
						<!--</div>-->
						<!--
						<div class="form-group">
							<label class="col-lg-2 control-label"><em class="text-danger"></em>视频来源</label>
							<div class="col-lg-10">
								<input class="form-control" type="text" placeholder="请输入视频来源" name="provider" value="{$data.provider}">
							</div>
						</div>
						-->

						<div class="form-group">
							<label class="col-lg-2 control-label"><em class="text-danger">*&nbsp;</em>集数</label>
							<div class="col-lg-10">
								<input class="form-control" type="text" placeholder="请输入集数" name="setnum" value="{$data.setnum}">
							</div>
						</div>

						<div class="form-group">
							<label class="col-lg-2 control-label"><em class="text-danger">*&nbsp;</em>导演</label>
							<div class="col-lg-10">
								<input class="form-control" type="text" placeholder="请输入导演" name="director" value="{$data.director}">
							</div>
						</div>
						<div class="form-group">
							<label class="col-lg-2 control-label"><em class="text-danger">*&nbsp;</em>主演</label>
							<div class="col-lg-10">
								<input class="form-control" type="text" placeholder="请输入主演" name="actors" value="{$data.actors}">
							</div>
						</div>
						<div class="form-group">
							<label class="col-lg-2 control-label"><em class="text-danger">*&nbsp;</em>国家</label>
							<div class="col-lg-10" style="width: 180px">
								<select name="country" id="country" class="form-control" >
									<foreach name="country" item="v">
										<option value="{$v.id},{$v.name}">
											{$v.name}
										</option>
									</foreach>
								</select>
							</div>

							<!--
							<div class="col-lg-10">
								<input class="form-control" type="text" placeholder="请输入国家" name="country" value="{$data.country}">
							</div>
							-->
						</div>
						<!--
						<div class="form-group">
							<label class="col-lg-2 control-label">属性</label>
							<div class="col-lg-10">
								<input class="form-control" type="text" placeholder="请输入属性，以逗号分隔" name="category" value="{$data.category}">
							</div>
						</div>
						-->
						<div class="form-group">
							<label class="col-lg-2 control-label"><em class="text-danger">*&nbsp;</em>年份</label>
							<div class="col-lg-10" style="width: 180px">
								<input  type="text" placeholder="请输入年份" name="years" value="{$data.years}"  readonly id="years" onclick="selecttime()">
							</div>
						</div>
						<div class="form-group">
							<label class="col-lg-2 control-label"><em class="text-danger">*&nbsp;</em>详情</label>
							<div class="col-lg-10">
								<textarea class="form-control" rows="5" name="intro">{$data.intro}</textarea>
							</div>
						</div>

						<div class="form-group">
							<label class="col-lg-2 control-label"><em class="text-danger">*&nbsp;</em>视频幻灯片</label>
							<div class="col-lg-10">
								<input class="form-control" type="file" name="bigimgs">
							</div>
						</div>
						<notempty name="data.imgs">
							<div class="form-group">
								<label class="col-lg-2 control-label">当前幻灯片</label>
								<div class="col-lg-10">
									<img src="{$Think.WEB_ROOT}{$data.imgs}" height="120px"/>
								</div>
							</div>
						</notempty>

						<!--
						<div class="form-group">
							<label class="col-lg-2 control-label"><em class="text-danger">*&nbsp;</em>视频图片</label>
							<div class="col-lg-10">
								<!--form
								<div id="queue"></div>
								<input id="file_upload" name="file_upload" type="file" multiple="true">
								<!-- </form>
								<div id='imagesdiv'>
									<volist name="simgs" id="vo">
										<div class='img-square'><img width='100px' src='{$Think.WEB_ROOT}{$vo}' style='margin:15px;'/></img>
											<br/>
											<a  class='btn btn-danger btn-xs' onclick="removeImgnode(this)"><i class='fa fa-trash-o fa-lg'></i> 删除</a>
											<input type='hidden'  name='img[]' value='{$vo}' ></div>
									</volist>
								</div>
							</div>
						</div>
						-->

						<div class="form-group">
							<label class="col-lg-2 control-label"></label>
							<div class="col-lg-10">
								<input type="hidden" name="act" value="{$act}"/>
								<input type="hidden" name="id" value="{$data.id}"/>
								<button type="submit" class="btn btn-success">保存</button>
								<a href="{:U('Resource/tvvideomgr')}" type="reset" class="btn btn-danger">取消</a>
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
</block>

<block name="extjs">
	<script src="__PUBLIC__/Uploadify/jquery.uploadify.min.js" type="text/javascript"></script>
	<script language="javascript" type="text/javascript">
		$(function(){
			$("select[name='cate']").find('option').each(function(){
				var self=this;
				if($(self).attr('value')== '{$data.videotype}'){
					$(self).prop('selected',true);
				}
			});
			$("#country").find('option').each(function(){
				var cid = $(this).attr('value').split(',');
				if(cid[0] ==  "{$data.countrycid}"){
					$(this).prop('selected',true);
				}
			});
			$("#label_cate").find('option').each(function(){
				var cid = $(this).attr('value').split(',');
				if(cid[0] ==  "{$data.categoryid}"){
					$(this).prop('selected',true);
				}
			});

		})
		$(document).ready(function() {
			//var globalVar = new GVar();
			setTimeout(function(){
				$('#file_upload').uploadify({
					'formData'     : {
					},
					'buttonText' : '添加图片...',
					'successTimeout' : 30,
					'swf'      : '__PUBLIC__/Uploadify/uploadify.swf',
					'uploader' : "{:U('Resource/tmpupimgs')}",
					'onUploadSuccess' : function(file, data, response) {
						if(response){
							var dataObj=eval("("+data+")");
							//console.log(dataObj);
							///*
							$.each(dataObj, function(i, n){
								console.log(n);
								var str=$('#imagesdiv').html();
								var add="<div class='img-square'><img width='100px' src='"+"{$Think.WEB_ROOT}"+n+"'" +"style='margin:15px;'/></img>"
										+"<br/><a  class='btn btn-danger btn-xs' onclick=\"removeImgnode(this)\"><i class='fa fa-trash-o fa-lg'></i> 删除 </a>"
										+"<input type='hidden'  name='img[]' value='"+n+"'></div>";
								str+=add;
								$('#imagesdiv').html(str);
							});//*/
						}
					}
				});
			},6);
		});
		function removeImgnode(node){
			if(!confirm('您是否确定要删除该图片？')){return  false;}
			else{
				var pdiv = node.parentNode;
				var mdiv = pdiv.parentNode;
				mdiv.removeChild(pdiv);
			}
		}
	</script>
	<script  src="__PUBLIC__/My97DatePicker/WdatePicker.js"></script>
	<script type="text/javascript">
		//时间选择
		$(function(){
			function selecttime(){
				WdatePicker({dateFmt:'yyyy'});
			}
			$('#years').click(function(){
				selecttime();
			});

		});
	</script>

</block>

<block name="extcss">
	<link href="__PUBLIC__/Uploadify/uploadify.css" rel="stylesheet" type="text/css">
	<style type="text/css" media="all">
		.img-square {
			text-align:center;
			width:200px;
			float:left;
			display:block;
			margin-right:10px;
		}
	</style>
</block>

